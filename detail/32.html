<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Patches contributed by University of California, Riverside</title>
    <style>
    .pagination {
        border-top: 1px solid #ddd;
        border-bottom: 1px solid #ddd;
        overflow-wrap: break-word;
    }
    .pagination a, .pagination span {
        margin: 0 4px;
    }

    </style>
</head>
<body>
    <h1>Patches contributed by University of California, Riverside</h1>
    <div class="pagination">
        <span>[1]</span><a href='32_2.html'>2</a><a href='32_2.html'>Next&gt;&gt;</a>
    </div>
    <hr>
    <pre>commit 68e8cc2a23b61862bf20ffc9b782a3fb49c65568
Author: Yizhuo Zhai &lt;yzhai003@ucr.edu&gt;
Date:   Wed Feb 2 15:58:08 2022 -0800

    fbdev: fbmem: Fix the implicit type casting
    
    In function do_fb_ioctl(), the "arg" is the type of unsigned long,
    and in "case FBIOBLANK:" this argument is casted into an int before
    passig to fb_blank(). In fb_blank(), the comparision
    if (blank &gt; FB_BLANK_POWERDOWN) would be bypass if the original
    "arg" is a large number, which is possible because it comes from
    the user input. Fix this by adding the check before the function
    call.
    
    Reviewed-by: Guenter Roeck &lt;linux@roeck-us.net&gt;
    Reviewed-by: Sam Ravnborg &lt;sam@ravnborg.org&gt;
    Acked-by: Helge Deller &lt;deller@gmx.de&gt;
    Signed-off-by: Yizhuo Zhai &lt;yzhai003@ucr.edu&gt;
    Signed-off-by: Daniel Vetter &lt;daniel.vetter@ffwll.ch&gt;
    Link: https://patchwork.freedesktop.org/patch/msgid/20220202235811.1621017-1-yzhai003@ucr.edu

diff --git a/drivers/video/fbdev/core/fbmem.c b/drivers/video/fbdev/core/fbmem.c
index 0fa7ede94fa6..13083ad8d751 100644
--- a/drivers/video/fbdev/core/fbmem.c
+++ b/drivers/video/fbdev/core/fbmem.c
@@ -1160,6 +1160,8 @@ static long do_fb_ioctl(struct fb_info *info, unsigned int cmd,
 		ret = fbcon_set_con2fb_map_ioctl(argp);
 		break;
 	case FBIOBLANK:
+		if (arg &gt; FB_BLANK_POWERDOWN)
+			return -EINVAL;
 		console_lock();
 		lock_fb_info(info);
 		ret = fb_blank(info, arg);</pre><hr><pre>commit 0726ed3065eeb910f9cea0c933bc021a848e00b3
Author: Yizhuo Zhai &lt;yzhai003@ucr.edu&gt;
Date:   Fri Dec 17 20:22:23 2021 -0800

    drm/amd/display: Fix the uninitialized variable in enable_stream_features()
    
    In function enable_stream_features(), the variable "old_downspread.raw"
    could be uninitialized if core_link_read_dpcd() fails, however, it is
    used in the later if statement, and further, core_link_write_dpcd()
    may write random value, which is potentially unsafe.
    
    Fixes: 6016cd9dba0f ("drm/amd/display: add helper for enabling mst stream features")
    Cc: stable@vger.kernel.org
    Signed-off-by: Yizhuo Zhai &lt;yzhai003@ucr.edu&gt;
    Signed-off-by: Alex Deucher &lt;alexander.deucher@amd.com&gt;

diff --git a/drivers/gpu/drm/amd/display/dc/core/dc_link.c b/drivers/gpu/drm/amd/display/dc/core/dc_link.c
index ee3c1c9eac4a..dc1380b6c5e0 100644
--- a/drivers/gpu/drm/amd/display/dc/core/dc_link.c
+++ b/drivers/gpu/drm/amd/display/dc/core/dc_link.c
@@ -1818,6 +1818,8 @@ static void enable_stream_features(struct pipe_ctx *pipe_ctx)
 		union down_spread_ctrl old_downspread;
 		union down_spread_ctrl new_downspread;
 
+		memset(&amp;old_downspread, 0, sizeof(old_downspread));
+
 		core_link_read_dpcd(link, DP_DOWNSPREAD_CTRL,
 				&amp;old_downspread.raw, sizeof(old_downspread));
 </pre><hr><pre>commit 5ba9c067b5ed1ccfec58acae07c6582f16b9d44b
Author: Yizhuo &lt;yzhai003@ucr.edu&gt;
Date:   Sun Jul 11 22:23:32 2021 +0200

    media: staging: atomisp: fix the uninitialized use in gc2235_detect()
    
    Inside function gc2235_detect(), variable "low" could be uninitialized
    if ov5693_read_reg() returns error, however, it affects the value of
    variable "id". The "id" is used in the later if statement, which is
    potentially unsafe.
    
    Link: https://lore.kernel.org/linux-media/20210711202334.27959-1-yzhai003@ucr.edu
    Signed-off-by: Yizhuo &lt;yzhai003@ucr.edu&gt;
    Signed-off-by: Mauro Carvalho Chehab &lt;mchehab+huawei@kernel.org&gt;

diff --git a/drivers/staging/media/atomisp/i2c/ov5693/atomisp-ov5693.c b/drivers/staging/media/atomisp/i2c/ov5693/atomisp-ov5693.c
index 5e3670c4fc29..6c95f57a52e9 100644
--- a/drivers/staging/media/atomisp/i2c/ov5693/atomisp-ov5693.c
+++ b/drivers/staging/media/atomisp/i2c/ov5693/atomisp-ov5693.c
@@ -1714,6 +1714,8 @@ static int ov5693_detect(struct i2c_client *client)
 	}
 	ret = ov5693_read_reg(client, OV5693_8BIT,
 			      OV5693_SC_CMMN_CHIP_ID_L, &amp;low);
+	if (ret)
+		return ret;
 	id = ((((u16)high) &lt;&lt; 8) | (u16)low);
 
 	if (id != OV5693_ID) {</pre><hr><pre>commit 0c980e3f5276ba2eb95c42919c5f1694e38ef86a
Author: Yizhuo &lt;yzhai003@ucr.edu&gt;
Date:   Fri Jun 25 07:38:56 2021 +0200

    media: atomisp: fix the uninitialized use and rename "retvalue"
    
    Inside function mt9m114_detect(), variable "retvalue" could
    be uninitialized if mt9m114_read_reg() returns error, however, it
    is used in the later if statement, which is potentially unsafe.
    
    The local variable "retvalue" is renamed to "model" to avoid
    confusion.
    
    Link: https://lore.kernel.org/linux-media/20210625053858.3862-1-yzhai003@ucr.edu
    Fixes: ad85094b293e ("Revert "media: staging: atomisp: Remove driver"")
    Signed-off-by: Yizhuo &lt;yzhai003@ucr.edu&gt;
    Signed-off-by: Mauro Carvalho Chehab &lt;mchehab+huawei@kernel.org&gt;

diff --git a/drivers/staging/media/atomisp/i2c/atomisp-mt9m114.c b/drivers/staging/media/atomisp/i2c/atomisp-mt9m114.c
index 11196180a206..34bf92de2f29 100644
--- a/drivers/staging/media/atomisp/i2c/atomisp-mt9m114.c
+++ b/drivers/staging/media/atomisp/i2c/atomisp-mt9m114.c
@@ -1545,16 +1545,19 @@ static struct v4l2_ctrl_config mt9m114_controls[] = {
 static int mt9m114_detect(struct mt9m114_device *dev, struct i2c_client *client)
 {
 	struct i2c_adapter *adapter = client-&gt;adapter;
-	u32 retvalue;
+	u32 model;
+	int ret;
 
 	if (!i2c_check_functionality(adapter, I2C_FUNC_I2C)) {
 		dev_err(&amp;client-&gt;dev, "%s: i2c error", __func__);
 		return -ENODEV;
 	}
-	mt9m114_read_reg(client, MISENSOR_16BIT, (u32)MT9M114_PID, &amp;retvalue);
-	dev-&gt;real_model_id = retvalue;
+	ret = mt9m114_read_reg(client, MISENSOR_16BIT, MT9M114_PID, &amp;model);
+	if (ret)
+		return ret;
+	dev-&gt;real_model_id = model;
 
-	if (retvalue != MT9M114_MOD_ID) {
+	if (model != MT9M114_MOD_ID) {
 		dev_err(&amp;client-&gt;dev, "%s: failed: client-&gt;addr = %x\n",
 			__func__, client-&gt;addr);
 		return -ENODEV;</pre><hr><pre>commit c275e5d349b0d2b1143607d28b9c7c14a8a0a9b4
Author: Yizhuo &lt;yzhai003@ucr.edu&gt;
Date:   Fri Jun 25 07:38:56 2021 +0200

    media: atomisp: fix the uninitialized use and rename "retvalue"
    
    Inside function mt9m114_detect(), variable "retvalue" could
    be uninitialized if mt9m114_read_reg() returns error, however, it
    is used in the later if statement, which is potentially unsafe.
    
    The local variable "retvalue" is renamed to "model" to avoid
    confusion.
    
    Link: https://lore.kernel.org/linux-media/20210625053858.3862-1-yzhai003@ucr.edu
    Fixes: ad85094 (media / atomisp: fix the uninitialized use of model ID)
    Signed-off-by: Yizhuo &lt;yzhai003@ucr.edu&gt;
    Signed-off-by: Mauro Carvalho Chehab &lt;mchehab+huawei@kernel.org&gt;

diff --git a/drivers/staging/media/atomisp/i2c/atomisp-mt9m114.c b/drivers/staging/media/atomisp/i2c/atomisp-mt9m114.c
index 11196180a206..34bf92de2f29 100644
--- a/drivers/staging/media/atomisp/i2c/atomisp-mt9m114.c
+++ b/drivers/staging/media/atomisp/i2c/atomisp-mt9m114.c
@@ -1545,16 +1545,19 @@ static struct v4l2_ctrl_config mt9m114_controls[] = {
 static int mt9m114_detect(struct mt9m114_device *dev, struct i2c_client *client)
 {
 	struct i2c_adapter *adapter = client-&gt;adapter;
-	u32 retvalue;
+	u32 model;
+	int ret;
 
 	if (!i2c_check_functionality(adapter, I2C_FUNC_I2C)) {
 		dev_err(&amp;client-&gt;dev, "%s: i2c error", __func__);
 		return -ENODEV;
 	}
-	mt9m114_read_reg(client, MISENSOR_16BIT, (u32)MT9M114_PID, &amp;retvalue);
-	dev-&gt;real_model_id = retvalue;
+	ret = mt9m114_read_reg(client, MISENSOR_16BIT, MT9M114_PID, &amp;model);
+	if (ret)
+		return ret;
+	dev-&gt;real_model_id = model;
 
-	if (retvalue != MT9M114_MOD_ID) {
+	if (model != MT9M114_MOD_ID) {
 		dev_err(&amp;client-&gt;dev, "%s: failed: client-&gt;addr = %x\n",
 			__func__, client-&gt;addr);
 		return -ENODEV;</pre><hr><pre>commit cac7100d4c51c04979dacdfe6c9a5e400d3f0a27
Author: Yizhuo Zhai &lt;yzhai003@ucr.edu&gt;
Date:   Sat Jun 19 22:26:50 2021 -0700

    Input: hideep - fix the uninitialized use in hideep_nvm_unlock()
    
    Inside function hideep_nvm_unlock(), variable "unmask_code" could
    be uninitialized if hideep_pgm_r_reg() returns error, however, it
    is used in the later if statement after an "and" operation, which
    is potentially unsafe.
    
    Signed-off-by: Yizhuo &lt;yzhai003@ucr.edu&gt;
    Signed-off-by: Dmitry Torokhov &lt;dmitry.torokhov@gmail.com&gt;

diff --git a/drivers/input/touchscreen/hideep.c b/drivers/input/touchscreen/hideep.c
index ddad4a82a5e5..e9547ee29756 100644
--- a/drivers/input/touchscreen/hideep.c
+++ b/drivers/input/touchscreen/hideep.c
@@ -361,13 +361,16 @@ static int hideep_enter_pgm(struct hideep_ts *ts)
 	return -EIO;
 }
 
-static void hideep_nvm_unlock(struct hideep_ts *ts)
+static int hideep_nvm_unlock(struct hideep_ts *ts)
 {
 	u32 unmask_code;
+	int error;
 
 	hideep_pgm_w_reg(ts, HIDEEP_FLASH_CFG, HIDEEP_NVM_SFR_RPAGE);
-	hideep_pgm_r_reg(ts, 0x0000000C, &amp;unmask_code);
+	error = hideep_pgm_r_reg(ts, 0x0000000C, &amp;unmask_code);
 	hideep_pgm_w_reg(ts, HIDEEP_FLASH_CFG, HIDEEP_NVM_DEFAULT_PAGE);
+	if (error)
+		return error;
 
 	/* make it unprotected code */
 	unmask_code &amp;= ~HIDEEP_PROT_MODE;
@@ -384,6 +387,8 @@ static void hideep_nvm_unlock(struct hideep_ts *ts)
 	NVM_W_SFR(HIDEEP_NVM_MASK_OFS, ts-&gt;nvm_mask);
 	SET_FLASH_HWCONTROL();
 	hideep_pgm_w_reg(ts, HIDEEP_FLASH_CFG, HIDEEP_NVM_DEFAULT_PAGE);
+
+	return 0;
 }
 
 static int hideep_check_status(struct hideep_ts *ts)
@@ -462,7 +467,9 @@ static int hideep_program_nvm(struct hideep_ts *ts,
 	u32 addr = 0;
 	int error;
 
-	hideep_nvm_unlock(ts);
+       error = hideep_nvm_unlock(ts);
+       if (error)
+               return error;
 
 	while (ucode_len &gt; 0) {
 		xfer_len = min_t(size_t, ucode_len, HIDEEP_NVM_PAGE_SIZE);</pre><hr><pre>commit 31218df77e7f1b9b0a136990a500a7f980e6a573
Author: Yizhuo &lt;yzhai003@ucr.edu&gt;
Date:   Thu Aug 29 21:43:59 2019 -0300

    media: media/pci/ivtv: Variable vbi.type could be uninitialized if macro v4l2_subdev_call set __result an error code
    
    Inside function compress_sliced_buf(), variable vbi.type is
    uninitialized if macro v4l2_subdev_call set __result an
    error code. However, vbi.type is used in the if statement
    without any check, which is potentially unsafe.
    
    Signed-off-by: Yizhuo &lt;yzhai003@ucr.edu&gt;
    Signed-off-by: Hans Verkuil &lt;hverkuil-cisco@xs4all.nl&gt;
    Signed-off-by: Mauro Carvalho Chehab &lt;mchehab+samsung@kernel.org&gt;

diff --git a/drivers/media/pci/ivtv/ivtv-vbi.c b/drivers/media/pci/ivtv/ivtv-vbi.c
index 6d22c0107d33..80478b026d75 100644
--- a/drivers/media/pci/ivtv/ivtv-vbi.c
+++ b/drivers/media/pci/ivtv/ivtv-vbi.c
@@ -325,7 +325,7 @@ static u32 compress_raw_buf(struct ivtv *itv, u8 *buf, u32 size)
 static u32 compress_sliced_buf(struct ivtv *itv, u32 line, u8 *buf, u32 size, u8 sav)
 {
 	u32 line_size = itv-&gt;vbi.sliced_decoder_line_size;
-	struct v4l2_decode_vbi_line vbi;
+	struct v4l2_decode_vbi_line vbi = {};
 	int i;
 	unsigned lines = 0;
 </pre><hr><pre>commit 472b39c3d1bba0616eb0e9a8fa3ad0f56927c7d7
Author: Yizhuo &lt;yzhai003@ucr.edu&gt;
Date:   Thu Oct 3 10:58:13 2019 -0700

    regulator: max8907: Fix the usage of uninitialized variable in max8907_regulator_probe()
    
    Inside function max8907_regulator_probe(), variable val could
    be uninitialized if regmap_read() fails. However, val is used
    later in the if statement to decide the content written to
    "pmic", which is potentially unsafe.
    
    Signed-off-by: Yizhuo &lt;yzhai003@ucr.edu&gt;
    Link: https://lore.kernel.org/r/20191003175813.16415-1-yzhai003@ucr.edu
    Signed-off-by: Mark Brown &lt;broonie@kernel.org&gt;

diff --git a/drivers/regulator/max8907-regulator.c b/drivers/regulator/max8907-regulator.c
index 76152aaa330b..96dc0eea7659 100644
--- a/drivers/regulator/max8907-regulator.c
+++ b/drivers/regulator/max8907-regulator.c
@@ -296,7 +296,10 @@ static int max8907_regulator_probe(struct platform_device *pdev)
 	memcpy(pmic-&gt;desc, max8907_regulators, sizeof(pmic-&gt;desc));
 
 	/* Backwards compatibility with MAX8907B; SD1 uses different voltages */
-	regmap_read(max8907-&gt;regmap_gen, MAX8907_REG_II2RR, &amp;val);
+	ret = regmap_read(max8907-&gt;regmap_gen, MAX8907_REG_II2RR, &amp;val);
+	if (ret)
+		return ret;
+
 	if ((val &amp; MAX8907_II2RR_VERSION_MASK) ==
 	    MAX8907_II2RR_VERSION_REV_B) {
 		pmic-&gt;desc[MAX8907_SD1].min_uV = 637500;
@@ -333,14 +336,20 @@ static int max8907_regulator_probe(struct platform_device *pdev)
 		}
 
 		if (pmic-&gt;desc[i].ops == &amp;max8907_ldo_ops) {
-			regmap_read(config.regmap, pmic-&gt;desc[i].enable_reg,
+			ret = regmap_read(config.regmap, pmic-&gt;desc[i].enable_reg,
 				    &amp;val);
+			if (ret)
+				return ret;
+
 			if ((val &amp; MAX8907_MASK_LDO_SEQ) !=
 			    MAX8907_MASK_LDO_SEQ)
 				pmic-&gt;desc[i].ops = &amp;max8907_ldo_hwctl_ops;
 		} else if (pmic-&gt;desc[i].ops == &amp;max8907_out5v_ops) {
-			regmap_read(config.regmap, pmic-&gt;desc[i].enable_reg,
+			ret = regmap_read(config.regmap, pmic-&gt;desc[i].enable_reg,
 				    &amp;val);
+			if (ret)
+				return ret;
+
 			if ((val &amp; (MAX8907_MASK_OUT5V_VINEN |
 						MAX8907_MASK_OUT5V_ENSRC)) !=
 			    MAX8907_MASK_OUT5V_ENSRC)</pre><hr><pre>commit 53de429f4e88f538f7a8ec2b18be8c0cd9b2c8e1
Author: Yizhuo &lt;yzhai003@ucr.edu&gt;
Date:   Tue Oct 1 13:24:39 2019 -0700

    net: hisilicon: Fix usage of uninitialized variable in function mdio_sc_cfg_reg_write()
    
    In function mdio_sc_cfg_reg_write(), variable "reg_value" could be
    uninitialized if regmap_read() fails. However, "reg_value" is used
    to decide the control flow later in the if statement, which is
    potentially unsafe.
    
    Signed-off-by: Yizhuo &lt;yzhai003@ucr.edu&gt;
    Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;

diff --git a/drivers/net/ethernet/hisilicon/hns_mdio.c b/drivers/net/ethernet/hisilicon/hns_mdio.c
index 3e863a71c513..7df5d7d211d4 100644
--- a/drivers/net/ethernet/hisilicon/hns_mdio.c
+++ b/drivers/net/ethernet/hisilicon/hns_mdio.c
@@ -148,11 +148,15 @@ static int mdio_sc_cfg_reg_write(struct hns_mdio_device *mdio_dev,
 {
 	u32 time_cnt;
 	u32 reg_value;
+	int ret;
 
 	regmap_write(mdio_dev-&gt;subctrl_vbase, cfg_reg, set_val);
 
 	for (time_cnt = MDIO_TIMEOUT; time_cnt; time_cnt--) {
-		regmap_read(mdio_dev-&gt;subctrl_vbase, st_reg, &amp;reg_value);
+		ret = regmap_read(mdio_dev-&gt;subctrl_vbase, st_reg, &amp;reg_value);
+		if (ret)
+			return ret;
+
 		reg_value &amp;= st_msk;
 		if ((!!check_st) == (!!reg_value))
 			break;</pre><hr><pre>commit 1252b283141f03c3dffd139292c862cae10e174d
Author: Yizhuo &lt;yzhai003@ucr.edu&gt;
Date:   Sun Sep 29 10:09:57 2019 -0700

    regulator: pfuze100-regulator: Variable "val" in pfuze100_regulator_probe() could be uninitialized
    
    In function pfuze100_regulator_probe(), variable "val" could be
    initialized if regmap_read() fails. However, "val" is used to
    decide the control flow later in the if statement, which is
    potentially unsafe.
    
    Signed-off-by: Yizhuo &lt;yzhai003@ucr.edu&gt;
    Link: https://lore.kernel.org/r/20190929170957.14775-1-yzhai003@ucr.edu
    Signed-off-by: Mark Brown &lt;broonie@kernel.org&gt;

diff --git a/drivers/regulator/pfuze100-regulator.c b/drivers/regulator/pfuze100-regulator.c
index df5df1c495ad..689537927f6f 100644
--- a/drivers/regulator/pfuze100-regulator.c
+++ b/drivers/regulator/pfuze100-regulator.c
@@ -788,7 +788,13 @@ static int pfuze100_regulator_probe(struct i2c_client *client,
 
 		/* SW2~SW4 high bit check and modify the voltage value table */
 		if (i &gt;= sw_check_start &amp;&amp; i &lt;= sw_check_end) {
-			regmap_read(pfuze_chip-&gt;regmap, desc-&gt;vsel_reg, &amp;val);
+			ret = regmap_read(pfuze_chip-&gt;regmap,
+						desc-&gt;vsel_reg, &amp;val);
+			if (ret) {
+				dev_err(&amp;client-&gt;dev, "Fails to read from the register.\n");
+				return ret;
+			}
+
 			if (val &amp; sw_hi) {
 				if (pfuze_chip-&gt;chip_id == PFUZE3000 ||
 					pfuze_chip-&gt;chip_id == PFUZE3001) {</pre>
    <div class="pagination">
        <span>[1]</span><a href='32_2.html'>2</a><a href='32_2.html'>Next&gt;&gt;</a>
    <div>
</body>
